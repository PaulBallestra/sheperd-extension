# 🌐 Cross-Browser Setup Guide

Your Sheperd extension now supports **both Chrome and Firefox** without removing any functionality! 

## 🔧 **What Was Fixed**

### Major Compatibility Issues Resolved:
1. **✅ API Namespace Compatibility** - Added unified browser API layer
2. **✅ Background Script Architecture** - Unified script works with both MV3 and MV2
3. **✅ Action API Differences** - Handles both `chrome.action` and `browserAction`
4. **✅ Promise vs Callback APIs** - Unified promise-based interface
5. **✅ Build System** - Separate builds for each browser

---

## 🚀 **Quick Start**

### **Build for Chrome:**
```bash
npm run build:chrome
```
Then load in `chrome://extensions/` (Developer Mode)

### **Build for Firefox:**
```bash
npm run build:firefox
```
Then load in `about:debugging` (This Firefox → Load Temporary Add-on)

### **Build for Both:**
```bash
npm run build:all
```

---

## 📁 **New Architecture**

```
sheperd-extension/
├── src/utils/browser-compatibility.js  # 🆕 Cross-browser API layer
├── background-unified.js               # 🆕 Unified background script
├── background.js                       # Generated by build scripts
├── manifest.json                       # Generated by build scripts
├── manifest-chrome.json               # Chrome Manifest V3
├── manifest-firefox.json              # Firefox Manifest V2
├── build-scripts/
│   ├── build-chrome.js                # Chrome build script
│   └── build-firefox.js               # Firefox build script
└── package.json                       # 🆕 Build automation
```

## 🔬 **Technical Changes Made**

### **1. Browser Compatibility Layer** (`src/utils/browser-compatibility.js`)
- Detects browser environment automatically
- Provides unified API interface
- Handles Chrome vs Firefox API differences
- Supports both callback and promise-based APIs

### **2. Unified Background Script** (`background-unified.js`)
- Works with both Chrome MV3 service workers and Firefox MV2 background scripts
- Handles different action APIs (`chrome.action` vs `browserAction`)
- Cross-browser badge management
- Unified event handling

### **3. Updated Core Files**
- **`src/utils/tabs.js`** - Now uses unified API instead of Chrome-only
- **`src/popup/popup.js`** - Cross-browser message handling
- **Build scripts** - Copy appropriate manifests and background script

---

## 🧪 **Testing Instructions**

### **Chrome Testing:**
1. Run `npm run build:chrome`
2. Open `chrome://extensions/`
3. Enable "Developer Mode"
4. Click "Load unpacked" → Select your project folder
5. Test all features (categorization, bulk actions, badge, etc.)

### **Firefox Testing:**
1. Run `npm run build:firefox`
2. Open `about:debugging`
3. Click "This Firefox" → "Load Temporary Add-on"
4. Select the `manifest.json` file
5. Test all features to ensure compatibility

### **Key Tests:**
- ✅ Tab categorization works
- ✅ Badge shows correct count and colors
- ✅ Bulk operations (close, bookmark) work
- ✅ Real-time updates function
- ✅ Settings and upgrade buttons work
- ✅ No console errors
- ✅ Performance analytics display correctly

---

## 🐛 **Common Issues & Solutions**

### **"Something went wrong" Error Fixed:**
- **Before:** Extension only checked for `chrome` namespace
- **After:** Detects both `chrome` and `browser` namespaces
- **Solution:** Use unified API layer for all browser operations

### **Firefox Badge Not Working:**
- **Issue:** Firefox uses `browserAction` instead of `action`
- **Solution:** Unified background script handles both APIs automatically

### **ES Module Issues:**
- **Issue:** Firefox MV2 doesn't support ES modules in background scripts
- **Solution:** Popup uses ES modules, background script uses regular JavaScript

---

## 📊 **Browser Compatibility Matrix**

| Feature | Chrome | Firefox | Notes |
|---------|---------|---------|-------|
| Tab Management | ✅ | ✅ | Full compatibility |
| Smart Categorization | ✅ | ✅ | Full compatibility |
| Badge Updates | ✅ | ✅ | Cross-browser API handling |
| Bulk Operations | ✅ | ✅ | Full compatibility |
| Real-time Updates | ✅ | ✅ | Cross-browser messaging |
| Storage (Sync) | ✅ | ✅ | Full compatibility |
| Bookmarks | ✅ | ✅ | Full compatibility |
| Alarms | ✅ | ✅ | Full compatibility |

---

## 🔄 **Development Workflow**

### **1. Development:**
```bash
# Chrome development
npm run dev:chrome

# Firefox development  
npm run dev:firefox
```

### **2. Testing:**
- Test features in both browsers
- Check console for errors
- Verify badge behavior
- Test all popup components

### **3. Production:**
```bash
# Build for distribution
npm run build:all
```

### **4. Clean builds:**
```bash
npm run clean  # Remove generated files
```

---

## 🎯 **Key Improvements**

### **✅ No Functionality Removed**
- All Chrome features work exactly the same
- Added Firefox support without breaking anything
- Same UI, same performance, same user experience

### **✅ Enhanced Error Handling**
- Better browser detection
- Graceful fallbacks for API differences
- Comprehensive error logging

### **✅ Future-Proof Architecture**
- Easy to add more browsers
- Unified API approach scales well
- Clean separation between browser-specific and shared code

---

## 🚧 **Troubleshooting**

### **Extension Won't Load:**
1. Check console for errors
2. Verify manifest.json was generated
3. Ensure background.js was created
4. Run the correct build script for your browser

### **Features Not Working:**
1. Check browser console (F12)
2. Look for API permission errors
3. Verify browser compatibility layer is working
4. Test with a fresh build

### **Badge Not Showing:**
1. Check if badge is enabled in settings
2. Verify correct action API is being used
3. Check background script console

---

## 📞 **Support**

If you encounter issues:
1. **Check browser console** for error messages
2. **Try a clean build** with `npm run clean && npm run build:chrome`
3. **Test in incognito/private mode** to avoid conflicts
4. **Compare behavior** between Chrome and Firefox

The extension now works seamlessly on both browsers while maintaining all existing functionality! 🎉 